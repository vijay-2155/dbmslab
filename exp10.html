<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Database Lab Experiments</title>
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Prism CSS -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-okaidia.min.css" rel="stylesheet" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-sql.min.js"></script>
    
    <style>
        .token.keyword { color: #569CD6; }
        .token.string { color: #CE9178; }
        .token.number { color: #B5CEA8; }
        .token.function { color: #DCDCAA; }
        .language-sql { color: #D4D4D4; }
        pre[class*="language-"] {
            background: #1E1E1E !important;
            margin: 0;
        }
    </style>
</head>
<body class="bg-gray-50">
    <div class="flex flex-col md:flex-row min-h-screen">
        <div id="sidebar" class="hidden md:block w-full md:w-72 bg-gradient-to-b from-gray-800 to-gray-900 text-white p-6 shadow-xl">
            <!-- Sidebar content will be generated by JavaScript -->
        </div>

        <div class="flex-1 p-4 md:p-8 overflow-y-auto">
            <div class="max-w-4xl mx-auto">
                <!-- Header -->
                <div class="bg-white rounded-xl shadow-lg p-4 md:p-6 mb-8">
                    <h1 class="text-2xl md:text-3xl font-bold text-gray-800 mb-4">Experiment 9: Stored Functions in PL/SQL</h1>
                    <div class="flex flex-col md:flex-row items-start md:items-center text-sm text-gray-500">
                        <span class="mb-2 md:mb-0 md:mr-4">üìÖ Date: May 5, 2025</span>
                        <span>‚è±Ô∏è Duration: 2 hours</span>
                    </div>
                </div>

                <!-- Aim Section -->
                <section class="mb-8">
                    <h2 class="text-2xl font-semibold text-gray-700 mb-4">Aim</h2>
                    <p class="text-gray-600">
                        To understand and implement stored functions in PL/SQL, learn how to invoke functions in SQL statements, and create complex functions with multiple operations.
                    </p>
                </section>

                <!-- Theory Section -->
                <section class="mb-8 bg-white p-6 rounded-lg shadow-lg">
                    <h2 class="text-2xl font-semibold text-gray-700 mb-4">Theory</h2>
                    <div class="space-y-4">
                        <p class="text-gray-600">
                            Stored functions are named PL/SQL blocks that can accept parameters and must return a value. Unlike procedures, functions:
                        </p>
                        
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                            <div class="bg-gray-50 rounded-lg p-4 border border-gray-200">
                                <h3 class="text-blue-600 font-semibold mb-2">Key Characteristics</h3>
                                <ul class="list-disc list-inside text-gray-600">
                                    <li>Must return a value</li>
                                    <li>Can be used in SQL statements</li>
                                    <li>Support deterministic option</li>
                                    <li>Can be nested</li>
                                </ul>
                            </div>

                            <div class="bg-gray-50 rounded-lg p-4 border border-gray-200">
                                <h3 class="text-green-600 font-semibold mb-2">Common Uses</h3>
                                <ul class="list-disc list-inside text-gray-600">
                                    <li>Complex calculations</li>
                                    <li>Data transformation</li>
                                    <li>Business logic implementation</li>
                                    <li>Reusable code modules</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Syntax Section -->
                <section class="mb-8">
                    <h2 class="text-2xl font-semibold text-gray-700 mb-4">Syntax Reference</h2>
                    
                    <!-- Basic Function Syntax -->
                    <div class="bg-gray-800 text-white p-4 rounded-lg mb-4 relative">
                        <button class="bg-blue-500 hover:bg-blue-600 text-white px-3 py-1 rounded absolute top-4 right-4 copy-button">Copy</button>
                        <pre><code class="language-sql">
-- Basic Function Structure
CREATE [OR REPLACE] FUNCTION function_name 
    [(parameter_name [IN] datatype [, ...])]
    RETURN return_datatype
IS|AS
    -- Declaration section
    [local variables, cursors, exceptions]
BEGIN
    -- Executable section
    [statements]
    RETURN value;
[EXCEPTION]
    -- Exception handling section
    [WHEN exception THEN statements]
END [function_name];
/

-- Invoking Function in SQL
SELECT function_name[(parameters)] FROM dual;
SELECT column_name, function_name(column_name) FROM table_name;</code></pre>
                    </div>
                </section>

                <!-- Sample Database Setup -->
                <section class="mb-8">
                    <h2 class="text-2xl font-semibold text-gray-700 mb-4">Database Setup</h2>
                    <div class="bg-gray-800 text-white p-4 rounded-lg mb-4 relative">
                        <button class="bg-blue-500 hover:bg-blue-600 text-white px-3 py-1 rounded absolute top-4 right-4 copy-button">Copy</button>
                        <pre><code class="language-sql">
-- Create Students table
CREATE TABLE students (
    student_id NUMBER PRIMARY KEY,
    student_name VARCHAR2(50),
    marks NUMBER CHECK (marks >= 0 AND marks <= 100)
);

-- Insert sample student data
INSERT INTO students (student_id, student_name, marks) VALUES (1, 'John Smith', 95);
INSERT INTO students (student_id, student_name, marks) VALUES (2, 'Mary Johnson', 82);
INSERT INTO students (student_id, student_name, marks) VALUES (3, 'David Lee', 75);
INSERT INTO students (student_id, student_name, marks) VALUES (4, 'Sarah Wilson', 68);
INSERT INTO students (student_id, student_name, marks) VALUES (5, 'Mike Brown', 55);
COMMIT;

-- Create Employees table
CREATE TABLE employees (
    employee_id NUMBER PRIMARY KEY,
    employee_name VARCHAR2(50),
    base_salary NUMBER,
    years_of_experience NUMBER,
    performance_rating NUMBER CHECK (performance_rating BETWEEN 1 AND 5)
);

-- Insert sample employee data
INSERT INTO employees VALUES (1, 'Alice Cooper', 50000, 5, 4);
INSERT INTO employees VALUES (2, 'Bob Martin', 60000, 8, 5);
INSERT INTO employees VALUES (3, 'Carol White', 45000, 3, 3);
INSERT INTO employees VALUES (4, 'David Brown', 55000, 6, 4);
INSERT INTO employees VALUES (5, 'Eve Wilson', 48000, 4, 3);
COMMIT;

-- Verify data
SELECT * FROM students ORDER BY student_id;
SELECT * FROM employees ORDER BY employee_id;</code></pre>
                    </div>

                    <!-- Query Results -->
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mt-4">
                        <div class="bg-gray-50 border border-gray-200 p-4 rounded-lg">
                            <h3 class="text-blue-600 font-semibold mb-2">Students Table</h3>
                            <pre class="text-gray-600">
STUDENT_ID  STUDENT_NAME   MARKS
--------------------------------
1           John Smith     95
2           Mary Johnson   82
3           David Lee      75
4           Sarah Wilson   68
5           Mike Brown     55</pre>
                        </div>

                        <div class="bg-gray-50 border border-gray-200 p-4 rounded-lg">
                            <h3 class="text-blue-600 font-semibold mb-2">Employees Table</h3>
                            <pre class="text-gray-600">
EMP_ID  EMPLOYEE_NAME  BASE_SAL  YRS_EXP  RATING
------------------------------------------------
1       Alice Cooper   50000     5         4
2       Bob Martin     60000     8         5
3       Carol White    45000     3         3
4       David Brown    55000     6         4
5       Eve Wilson     48000     4         3</pre>
                        </div>
                    </div>
                </section>

                <!-- Implementation Examples -->
                <section class="mb-8">
                    <h2 class="text-2xl font-semibold text-gray-700 mb-4">Implementation Examples</h2>
                    
                    <!-- Program 1: Basic Function -->
                    <div class="mb-6">
                        <h3 class="text-xl text-blue-600 font-semibold mb-3">Program 1: Calculate Grade Function</h3>
                        <div class="bg-gray-800 text-white p-4 rounded-lg mb-4 relative">
                            <button class="bg-blue-500 hover:bg-blue-600 text-white px-3 py-1 rounded absolute top-4 right-4 copy-button">Copy</button>
                            <pre><code class="language-sql">
CREATE OR REPLACE FUNCTION calculate_grade(p_marks IN NUMBER)
RETURN VARCHAR2
IS
    v_grade VARCHAR2(2);
BEGIN
    v_grade := 
        CASE 
            WHEN p_marks >= 90 THEN 'A+'
            WHEN p_marks >= 80 THEN 'A'
            WHEN p_marks >= 70 THEN 'B'
            WHEN p_marks >= 60 THEN 'C'
            ELSE 'F'
        END;
    
    RETURN v_grade;
EXCEPTION
    WHEN OTHERS THEN
        RETURN 'ERROR';
END;
/

-- Using the function in SQL
SELECT 
    student_name,
    marks,
    calculate_grade(marks) as grade
FROM students;</code></pre>
                        </div>
                    </div>

                    <!-- Program 2: Complex Function -->
                    <div class="mb-6">
                        <h3 class="text-xl text-green-600 font-semibold mb-3">Program 2: Complex Salary Calculator</h3>
                        <div class="bg-gray-800 text-white p-4 rounded-lg mb-4 relative">
                            <button class="bg-blue-500 hover:bg-blue-600 text-white px-3 py-1 rounded absolute top-4 right-4 copy-button">Copy</button>
                            <pre><code class="language-sql">
CREATE OR REPLACE FUNCTION calculate_total_salary(
    p_base_salary IN NUMBER,
    p_years_exp IN NUMBER,
    p_performance_rating IN NUMBER
) RETURN NUMBER
IS
    v_total_salary NUMBER;
    v_bonus NUMBER;
    v_experience_bonus NUMBER;
    v_performance_bonus NUMBER;
BEGIN
    -- Calculate experience bonus (2% per year)
    v_experience_bonus := p_base_salary * (p_years_exp * 0.02);
    
    -- Calculate performance bonus
    v_performance_bonus := 
        CASE p_performance_rating
            WHEN 5 THEN p_base_salary * 0.20
            WHEN 4 THEN p_base_salary * 0.15
            WHEN 3 THEN p_base_salary * 0.10
            ELSE 0
        END;
    
    -- Calculate total salary
    v_total_salary := p_base_salary + v_experience_bonus + v_performance_bonus;
    
    -- Apply maximum cap
    RETURN LEAST(v_total_salary, p_base_salary * 2);
EXCEPTION
    WHEN OTHERS THEN
        -- Return base salary if any error occurs
        RETURN p_base_salary;
END;
/

-- Using the complex function
SELECT 
    employee_name,
    base_salary,
    years_of_experience,
    performance_rating,
    calculate_total_salary(
        base_salary, 
        years_of_experience, 
        performance_rating
    ) as total_salary
FROM employees;</code></pre>
                        </div>
                    </div>

                    <!-- Output Section -->
                    <section class="mb-8">
                        <h2 class="text-xl md:text-2xl font-semibold text-gray-700 mb-4">Sample Outputs</h2>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div class="bg-green-50 border border-green-200 p-4 rounded-lg">
                                <h3 class="text-green-800 font-semibold mb-2">Program 1 Output:</h3>
                                <pre class="text-green-800">
STUDENT_NAME    MARKS    GRADE
--------------------------------
John Smith      95       A+
Mary Johnson    82       A
David Lee       75       B
Sarah Wilson    68       C
Mike Brown      55       F</pre>
                            </div>
                            <div class="bg-green-50 border border-green-200 p-4 rounded-lg">
                                <h3 class="text-green-800 font-semibold mb-2">Program 2 Output:</h3>
                                <pre class="text-green-800">
EMPLOYEE_NAME    BASE_SAL    YRS_EXP    RATING    TOTAL_SAL
------------------------------------------------------
Alice Cooper     50000       5          4         65000
Bob Martin       60000       8          5         84000
Carol White      45000       3          3         52650</pre>
                            </div>
                        </div>
                    </section>
                </section>
            </div>
        </div>
    </div>
    <script src="js/main.js"></script>
</body>
</html>
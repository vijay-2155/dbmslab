<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Database Lab Experiments</title>
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Prism CSS -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-okaidia.min.css" rel="stylesheet" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-sql.min.js"></script>
    
    <style>
        .token.keyword { color: #569CD6; }
        .token.string { color: #CE9178; }
        .token.number { color: #B5CEA8; }
        .token.function { color: #DCDCAA; }
        .language-sql { color: #D4D4D4; }
        pre[class*="language-"] {
            background: #1E1E1E !important;
            margin: 0;
        }
    </style>
</head>
<body class="bg-gray-50">
    <div class="flex flex-col md:flex-row min-h-screen">
        <div id="sidebar" class="hidden md:block w-full md:w-72 bg-gradient-to-b from-gray-800 to-gray-900 text-white p-6 shadow-xl">
            <!-- Sidebar content will be generated by JavaScript -->
        </div>

        <div class="flex-1 p-4 md:p-8 overflow-y-auto">
            <div class="max-w-4xl mx-auto">
                <!-- Header -->
                <div class="bg-white rounded-xl shadow-lg p-4 md:p-6 mb-8">
                    <h1 class="text-2xl md:text-3xl font-bold text-gray-800 mb-4">Experiment 10: Cursors in PL/SQL</h1>
                    <div class="flex flex-col md:flex-row items-start md:items-center text-sm text-gray-500">
                        <span class="mb-2 md:mb-0 md:mr-4">üìÖ Date: May 5, 2025</span>
                        <span>‚è±Ô∏è Duration: 2 hours</span>
                    </div>
                </div>

                <!-- Theory Section -->
                <section class="mb-8 bg-white p-6 rounded-lg shadow-lg">
                    <h2 class="text-2xl font-semibold text-gray-700 mb-4">Theory</h2>
                    <div class="space-y-4">
                        <p class="text-gray-600">
                            Cursors in PL/SQL are database objects used to handle SELECT statements that return multiple rows. They allow row-by-row processing of query results.
                        </p>
                        
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                            <div class="bg-gray-50 rounded-lg p-4 border border-gray-200">
                                <h3 class="text-blue-600 font-semibold mb-2">Types of Cursors</h3>
                                <ul class="list-disc list-inside text-gray-600">
                                    <li>Implicit Cursors</li>
                                    <li>Explicit Cursors</li>
                                    <li>Parameterized Cursors</li>
                                    <li>FOR UPDATE Cursors</li>
                                </ul>
                            </div>

                            <div class="bg-gray-50 rounded-lg p-4 border border-gray-200">
                                <h3 class="text-green-600 font-semibold mb-2">Cursor Attributes</h3>
                                <ul class="list-disc list-inside text-gray-600">
                                    <li>%ISOPEN - Returns TRUE if cursor is open</li>
                                    <li>%FOUND - Returns TRUE if row was fetched</li>
                                    <li>%NOTFOUND - Returns TRUE if no row was fetched</li>
                                    <li>%ROWCOUNT - Number of rows fetched</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Syntax Section -->
                <section class="mb-8">
                    <h2 class="text-2xl font-semibold text-gray-700 mb-4">Syntax Reference</h2>
                    
                    <div class="bg-gray-800 text-white p-4 rounded-lg mb-4 relative">
                        <button class="bg-blue-500 hover:bg-blue-600 text-white px-3 py-1 rounded absolute top-4 right-4 copy-button">Copy</button>
                        <pre><code class="language-sql">
-- Basic Cursor Declaration
CURSOR cursor_name [(parameter_name datatype, ...)] IS select_statement;

-- FOR UPDATE Cursor
CURSOR cursor_name IS 
    SELECT column1, column2 
    FROM table_name 
    FOR UPDATE [OF column1, column2] [NOWAIT];

-- Cursor WITH HOLD
CURSOR cursor_name WITH HOLD IS select_statement;

-- Using WHERE CURRENT OF
UPDATE table_name 
SET column = value 
WHERE CURRENT OF cursor_name;

-- Cursor Variables
TYPE cursor_type IS REF CURSOR [RETURN return_type];
cursor_variable cursor_type;</code></pre>
                    </div>
                </section>

                <!-- Example Code -->
                <section class="mb-8">
                    <h2 class="text-2xl font-semibold text-gray-700 mb-4">Implementation Examples</h2>
                    
                    <!-- Program 1: Parameterized Cursor -->
                    <div class="mb-6">
                        <h3 class="text-xl text-blue-600 font-semibold mb-3">Program 1: Employee Salary Update using Parameterized Cursor</h3>
                        <div class="bg-gray-800 text-white p-4 rounded-lg mb-4 relative">
                            <button class="bg-blue-500 hover:bg-blue-600 text-white px-3 py-1 rounded absolute top-4 right-4 copy-button">Copy</button>
                            <pre><code class="language-sql">
-- Create test table
CREATE TABLE employees (
    emp_id NUMBER PRIMARY KEY,
    name VARCHAR2(50),
    salary NUMBER,
    department VARCHAR2(50)
);

-- Insert test data
INSERT INTO employees VALUES (1, 'John Doe', 50000, 'IT');
INSERT INTO employees VALUES (2, 'Jane Smith', 60000, 'HR');
INSERT INTO employees VALUES (3, 'Bob Wilson', 55000, 'IT');

-- Parameterized cursor example
DECLARE
    CURSOR emp_cursor (p_dept VARCHAR2, p_min_salary NUMBER) IS
        SELECT emp_id, name, salary
        FROM employees
        WHERE department = p_dept
        AND salary >= p_min_salary
        FOR UPDATE OF salary NOWAIT;
    
    v_emp_id employees.emp_id%TYPE;
    v_name employees.name%TYPE;
    v_salary employees.salary%TYPE;
    v_raise_amount NUMBER := 5000;
BEGIN
    -- Open cursor for IT department
    FOR emp_rec IN emp_cursor('IT', 50000) LOOP
        -- Update salary using WHERE CURRENT OF
        UPDATE employees 
        SET salary = salary + v_raise_amount
        WHERE CURRENT OF emp_cursor;
        
        DBMS_OUTPUT.PUT_LINE('Updated salary for: ' || emp_rec.name);
    END LOOP;
    
    COMMIT;
EXCEPTION
    WHEN OTHERS THEN
        ROLLBACK;
        RAISE;
END;
/</code></pre>
                        </div>
                    </div>

                    <!-- Program 2: Cursor Variables -->
                    <div class="mb-6">
                        <h3 class="text-xl text-green-600 font-semibold mb-3">Program 2: Dynamic Department Report using Cursor Variables</h3>
                        <div class="bg-gray-800 text-white p-4 rounded-lg mb-4 relative">
                            <button class="bg-blue-500 hover:bg-blue-600 text-white px-3 py-1 rounded absolute top-4 right-4 copy-button">Copy</button>
                            <pre><code class="language-sql">
DECLARE
    TYPE emp_cur_type IS REF CURSOR;
    v_emp_cursor emp_cur_type;
    v_dept_name VARCHAR2(50);
    v_emp_count NUMBER;
    v_total_salary NUMBER;
    
    -- Record type for employee data
    TYPE emp_rec_type IS RECORD (
        name VARCHAR2(50),
        salary NUMBER
    );
    v_emp_rec emp_rec_type;
    
BEGIN
    -- Process each department
    FOR dept IN (SELECT DISTINCT department FROM employees) LOOP
        v_dept_name := dept.department;
        v_emp_count := 0;
        v_total_salary := 0;
        
        -- Open cursor for current department
        OPEN v_emp_cursor FOR
            SELECT name, salary
            FROM employees
            WHERE department = v_dept_name;
            
        DBMS_OUTPUT.PUT_LINE('Department: ' || v_dept_name);
        DBMS_OUTPUT.PUT_LINE('------------------------');
        
        -- Fetch employee data
        LOOP
            FETCH v_emp_cursor INTO v_emp_rec;
            EXIT WHEN v_emp_cursor%NOTFOUND;
            
            v_emp_count := v_emp_count + 1;
            v_total_salary := v_total_salary + v_emp_rec.salary;
            
            DBMS_OUTPUT.PUT_LINE(v_emp_rec.name || ': ' || 
                                TO_CHAR(v_emp_rec.salary, '$999,999'));
        END LOOP;
        
        -- Print department summary
        DBMS_OUTPUT.PUT_LINE('------------------------');
        DBMS_OUTPUT.PUT_LINE('Total Employees: ' || v_emp_count);
        DBMS_OUTPUT.PUT_LINE('Average Salary: ' || 
                            TO_CHAR(v_total_salary/v_emp_count, '$999,999'));
        DBMS_OUTPUT.PUT_LINE(CHR(10));
        
        CLOSE v_emp_cursor;
    END LOOP;
END;
/</code></pre>
                        </div>
                    </div>

                    <!-- Output Section -->
                    <section class="mb-8">
                        <h2 class="text-xl md:text-2xl font-semibold text-gray-700 mb-4">Sample Outputs</h2>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div class="bg-green-50 border border-green-200 p-4 rounded-lg">
                                <h3 class="text-green-800 font-semibold mb-2">Program 1 Output:</h3>
                                <pre class="text-green-800">
Updated salary for: John Doe
Updated salary for: Bob Wilson

Select * from employees where department = 'IT';
EMP_ID  NAME        SALARY    DEPARTMENT
----------------------------------------
1       John Doe    55000     IT
3       Bob Wilson  60000     IT</pre>
                            </div>
                            <div class="bg-green-50 border border-green-200 p-4 rounded-lg">
                                <h3 class="text-green-800 font-semibold mb-2">Program 2 Output:</h3>
                                <pre class="text-green-800">
Department: IT
------------------------
John Doe: $55,000
Bob Wilson: $60,000
------------------------
Total Employees: 2
Average Salary: $57,500

Department: HR
------------------------
Jane Smith: $60,000
------------------------
Total Employees: 1
Average Salary: $60,000</pre>
                            </div>
                        </div>
                    </section>
                </section>
            </div>
        </div>
    </div>
    <script src="js/main.js"></script>
</body>
</html>